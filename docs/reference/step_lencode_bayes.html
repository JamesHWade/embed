<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Supervised Factor Conversions into Linear Functions using Bayesian Likelihood Encodings — step_lencode_bayes • embed</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>

<!-- Bootstrap -->
<link href="../tidyverse.css" rel="stylesheet">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>
<link href="../tidyverse-2.css" rel="stylesheet">



<meta property="og:title" content="Supervised Factor Conversions into Linear Functions using Bayesian Likelihood Encodings — step_lencode_bayes" />
<meta property="og:description" content="step_lencode_bayes creates a specification of a recipe step that
will convert a nominal (i.e. factor) predictor into a single set of
scores derived from a generalized linear model estimated using
Bayesian analysis." />
<meta name="twitter:card" content="summary" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="../index.html">embed</a>
        <div class="info">
          <span class="partof">part of <a href="https://github.com/tidymodels">tidymodels</a></span>
          <span class="version version-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.6</span>
        </div>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="../articles/Applications/GLM.html">Generalized Linear Models</a>
</li>
<li>
  <a href="../articles/Applications/Tensorflow.html">Tensorflow</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
        <li>
  <a href="https://github.com/tidymodels/embed/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Supervised Factor Conversions into Linear Functions using Bayesian Likelihood Encodings</h1>
    <small class="dont-index">Source: <a href='https://github.com/tidymodels/embed/blob/master/R/bayes.R'><code>R/bayes.R</code></a></small>
    <div class="hidden name"><code>step_lencode_bayes.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>step_lencode_bayes</code> creates a <em>specification</em> of a recipe step that
will convert a nominal (i.e. factor) predictor into a single set of
scores derived from a generalized linear model estimated using
Bayesian analysis.</p>
    </div>

    <pre class="usage"><span class='fu'>step_lencode_bayes</span>(
  <span class='no'>recipe</span>,
  <span class='no'>...</span>,
  <span class='kw'>role</span> <span class='kw'>=</span> <span class='fl'>NA</span>,
  <span class='kw'>trained</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>outcome</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>options</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>seed</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample.int</a></span>(<span class='fl'>10</span>^<span class='fl'>5</span>, <span class='fl'>1</span>)),
  <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>mapping</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>skip</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>id</span> <span class='kw'>=</span> <span class='fu'>rand_id</span>(<span class='st'>"lencode_bayes"</span>)
)

<span class='co'># S3 method for step_lencode_bayes</span>
<span class='fu'><a href='https://rdrr.io/pkg/generics/man/tidy.html'>tidy</a></span>(<span class='no'>x</span>, <span class='no'>...</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>recipe</th>
      <td><p>A recipe object. The step will be added to the
sequence of operations for this recipe.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>One or more selector functions to choose variables.
For <code>step_lencode_bayes</code>, this indicates the variables to be encoded
into a numeric format. See <code><a href='https://rdrr.io/pkg/recipes/man/selections.html'>recipes::selections()</a></code> for more details. For
the <code>tidy</code> method, these are not currently used.</p></td>
    </tr>
    <tr>
      <th>role</th>
      <td><p>Not used by this step since no new variables are
created.</p></td>
    </tr>
    <tr>
      <th>trained</th>
      <td><p>A logical to indicate if the quantities for
preprocessing have been estimated.</p></td>
    </tr>
    <tr>
      <th>outcome</th>
      <td><p>A call to <code>vars</code> to specify which variable is
used as the outcome in the generalized linear model. Only
numeric and two-level factors are currently supported.</p></td>
    </tr>
    <tr>
      <th>options</th>
      <td><p>A list of options to pass to <code><a href='https://mc-stan.org/rstanarm/reference/stan_glmer.html'>rstanarm::stan_glmer()</a></code>.</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>A logical to control the default printing by
<code><a href='https://mc-stan.org/rstanarm/reference/stan_glmer.html'>rstanarm::stan_glmer()</a></code>.</p></td>
    </tr>
    <tr>
      <th>mapping</th>
      <td><p>A list of tibble results that define the
encoding. This is <code>NULL</code> until the step is trained by
<code><a href='https://rdrr.io/pkg/recipes/man/prep.html'>recipes::prep.recipe()</a></code>.</p></td>
    </tr>
    <tr>
      <th>skip</th>
      <td><p>A logical. Should the step be skipped when the
recipe is baked by <code><a href='https://rdrr.io/pkg/recipes/man/bake.html'>recipes::bake.recipe()</a></code>? While all operations are baked
when <code><a href='https://rdrr.io/pkg/recipes/man/prep.html'>recipes::prep.recipe()</a></code> is run, some operations may not be able to be
conducted on new data (e.g. processing the outcome variable(s)).
Care should be taken when using <code>skip = TRUE</code> as it may affect
the computations for subsequent operations</p></td>
    </tr>
    <tr>
      <th>id</th>
      <td><p>A character string that is unique to this step to identify it.</p></td>
    </tr>
    <tr>
      <th>x</th>
      <td><p>A <code>step_lencode_bayes</code> object.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An updated version of <code>recipe</code> with the new step added
to the sequence of existing steps (if any). For the <code>tidy</code>
method, a tibble with columns <code>terms</code> (the selectors or
variables for encoding), <code>level</code> (the factor levels), and
<code>value</code> (the encodings).</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>For each factor predictor, a generalized linear model
is fit to the outcome and the coefficients are returned as the
encoding. These coefficients are on the linear predictor scale
so, for factor outcomes, they are in log-odds units. The
coefficients are created using a no intercept model and, when
two factor outcomes are used, the log-odds reflect the event of
interest being the <em>first</em> level of the factor.</p>
<p>For novel levels, a slightly timmed average of the coefficients
is returned.</p>
<p>A hierarchical generalized linear model is fit using
<code><a href='https://mc-stan.org/rstanarm/reference/stan_glmer.html'>rstanarm::stan_glmer()</a></code> and no intercept via</p><pre>  <span class='fu'>stan_glmer</span>(<span class='no'>outcome</span> ~ (<span class='fl'>1</span> <span class='kw'>|</span> <span class='no'>predictor</span>), <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>data</span>, <span class='no'>...</span>)</pre>

<p>where the <code>...</code> include the <code>family</code> argument (automatically
set by the step) as well as any arguments given to the <code>options</code>
argument to the step. Relevant options include <code>chains</code>, <code>iter</code>,
<code>cores</code>, and arguments for the priors (see the links in the
References below). <code>prior_intercept</code> is the argument that has the
most effect on the amount of shrinkage.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Micci-Barreca D (2001) "A preprocessing scheme for
high-cardinality categorical attributes in classification and
prediction problems," ACM SIGKDD Explorations Newsletter, 3(1),
27-32.</p>
<p>Zumel N and Mount J (2017) "vtreat: a data.frame Processor for
Predictive Modeling," arXiv:1611.09477</p>
<p>"Hierarchical Partial Pooling for Repeated Binary Trials"
<a href='https://tinyurl.com/stan-pooling'>https://tinyurl.com/stan-pooling</a></p>
<p>"Prior Distributions for `rstanarm`` Models"
<a href='https://tinyurl.com/stan-priors'>https://tinyurl.com/stan-priors</a></p>
<p>"Estimating Generalized (Non-)Linear Models with Group-Specific
Terms with <code>rstanarm</code>" <a href='https://tinyurl.com/stan-glm-grouped'>https://tinyurl.com/stan-glm-grouped</a></p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>recipes</span>)
<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>dplyr</span>)
<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>modeldata</span>)

<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='no'>okc</span>)

<span class='no'>reencoded</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/recipes/man/recipe.html'>recipe</a></span>(<span class='no'>Class</span> ~ <span class='no'>age</span> + <span class='no'>location</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>okc</span>) <span class='kw'>%&gt;%</span>
  <span class='fu'>step_lencode_bayes</span>(<span class='no'>location</span>, <span class='kw'>outcome</span> <span class='kw'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/vars.html'>vars</a></span>(<span class='no'>Class</span>))

<span class='co'># See https://tidymodels.github.io/embed/ for examples</span></div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="tidyverse">
  <p><code>embed</code> is a part of the <strong>tidymodels</strong> ecosystem, a collection of modeling packages designed with common APIs and a shared philosophy.</p>
</div>

<div class="author">
  <p>
    Developed by Max Kuhn.
    Site built by <a href="https://pkgdown.r-lib.org">pkgdown</a>.
  </p>
</div>

      </footer>
   </div>

  


  </body>
</html>



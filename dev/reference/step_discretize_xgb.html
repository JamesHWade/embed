<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Discretize numeric variables with XgBoost — step_discretize_xgb • embed</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>

<!-- Bootstrap -->
<link href="../tidyverse.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>
<link href="../tidyverse-2.css" rel="stylesheet">

<!--optional theme-->
<link href="../tidymodels.css" rel="stylesheet">




<meta property="og:title" content="Discretize numeric variables with XgBoost — step_discretize_xgb" />
<meta property="og:description" content="step_discretize_xgb creates a specification of a recipe step that will
discretize numeric data (e.g. integers or doubles) into bins in a
supervised way using an XgBoost model." />
<meta property="og:image" content="https://embed.tidymodels.org/logo.png" />
<meta name="twitter:card" content="summary" />


<meta name="robots" content="noindex">

<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-115082821-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-115082821-1');
</script>

  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="../index.html">embed</a>
        <div class="info hidden-xs hidden-sm">
          <span class="partof">part of <a href="https://tidymodels.org">tidymodels</a></span>
          <span class="version version-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">0.1.4.9000</span>
        </div>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="../articles/Applications/GLM.html">Generalized Linear Models</a>
</li>
<li>
  <a href="../articles/Applications/Tensorflow.html">Tensorflow</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
        <li>
  <a href="https://github.com/tidymodels/embed/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Discretize numeric variables with XgBoost</h1>
    <small class="dont-index">Source: <a href='https://github.com/tidymodels/embed/blob/master/R/discretize_xgb.R'><code>R/discretize_xgb.R</code></a></small>
    <div class="hidden name"><code>step_discretize_xgb.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>step_discretize_xgb</code> creates a <em>specification</em> of a recipe step that will
discretize numeric data (e.g. integers or doubles) into bins in a
supervised way using an XgBoost model.</p>
    </div>

    <pre class="usage"><span class='fu'>step_discretize_xgb</span><span class='op'>(</span>
  <span class='va'>recipe</span>,
  <span class='va'>...</span>,
  role <span class='op'>=</span> <span class='cn'>NA</span>,
  trained <span class='op'>=</span> <span class='cn'>FALSE</span>,
  outcome <span class='op'>=</span> <span class='cn'>NULL</span>,
  sample_val <span class='op'>=</span> <span class='fl'>0.2</span>,
  learn_rate <span class='op'>=</span> <span class='fl'>0.3</span>,
  num_breaks <span class='op'>=</span> <span class='fl'>10</span>,
  tree_depth <span class='op'>=</span> <span class='fl'>1</span>,
  min_n <span class='op'>=</span> <span class='fl'>5</span>,
  rules <span class='op'>=</span> <span class='cn'>NULL</span>,
  skip <span class='op'>=</span> <span class='cn'>FALSE</span>,
  id <span class='op'>=</span> <span class='fu'>rand_id</span><span class='op'>(</span><span class='st'>"discretize_xgb"</span><span class='op'>)</span>
<span class='op'>)</span>

<span class='co'># S3 method for step_discretize_xgb</span>
<span class='fu'><a href='https://generics.r-lib.org/reference/tidy.html'>tidy</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>...</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>recipe</th>
      <td><p>A recipe object. The step will be added to the sequence of
operations for this recipe.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>One or more selector functions to choose which variables are
affected by the step. See <code>selections()</code> for more details.</p></td>
    </tr>
    <tr>
      <th>role</th>
      <td><p>Defaults to <code>"predictor"</code>.</p></td>
    </tr>
    <tr>
      <th>trained</th>
      <td><p>A logical to indicate if the quantities for preprocessing
have been estimated.</p></td>
    </tr>
    <tr>
      <th>outcome</th>
      <td><p>A call to <code>vars</code> to specify which variable is used as the
outcome to train XgBoost models in order to discretize explanatory
variables.</p></td>
    </tr>
    <tr>
      <th>sample_val</th>
      <td><p>Share of data used for validation (with early stopping) of the learned splits
(the rest is used for training). Defaults to 0.20.</p></td>
    </tr>
    <tr>
      <th>learn_rate</th>
      <td><p>The rate at which the boosting algorithm adapts from
iteration-to-iteration. Corresponds to <code>eta</code> in the <span class="pkg">xgboost</span> package.
Defaults to 0.3.</p></td>
    </tr>
    <tr>
      <th>num_breaks</th>
      <td><p>The <em>maximum</em> number of discrete bins to bucket continuous
features. Corresponds to <code>max_bin</code> in the <span class="pkg">xgboost</span> package. Defaults to
10.</p></td>
    </tr>
    <tr>
      <th>tree_depth</th>
      <td><p>The maximum depth of the tree (i.e. number of splits).
Corresponds to <code>max_depth</code> in the <span class="pkg">xgboost</span> package. Defaults to 1.</p></td>
    </tr>
    <tr>
      <th>min_n</th>
      <td><p>The minimum number of instances needed to be in each node.
Corresponds to <code>min_child_weight</code> in the <span class="pkg">xgboost</span> package. Defaults to 5.</p></td>
    </tr>
    <tr>
      <th>rules</th>
      <td><p>The splitting rules of the best XgBoost tree to retain for
each variable.</p></td>
    </tr>
    <tr>
      <th>skip</th>
      <td><p>A logical. Should the step be skipped when the
recipe is baked by <code><a href='https://recipes.tidymodels.org/reference/bake.html'>recipes::bake.recipe()</a></code>? While all operations are baked
when <code><a href='https://recipes.tidymodels.org/reference/prep.html'>recipes::prep.recipe()</a></code> is run, some operations may not be able to be
conducted on new data (e.g. processing the outcome variable(s)).
Care should be taken when using <code>skip = TRUE</code> as it may affect
the computations for subsequent operations</p></td>
    </tr>
    <tr>
      <th>id</th>
      <td><p>A character string that is unique to this step to identify it.</p></td>
    </tr>
    <tr>
      <th>x</th>
      <td><p>A <code>step_discretize_xgb</code> object.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An updated version of <code>recipe</code> with the new step added to the
sequence of existing steps (if any).</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p><code>step_discretize_xgb()</code> creates non-uniform bins from numerical
variables by utilizing the information about the outcome variable and
applying the xgboost model. It is advised to impute missing values before
this step. This step is intended to be used particularly with linear models
because thanks to creating non-uniform bins it becomes easier to learn
non-linear patterns from the data.</p>
<p>The best selection of buckets for each variable is selected using
an internal early stopping scheme implemented in the <span class="pkg">xgboost</span>
package, which makes this discretization method prone to overfitting.</p>
<p>The pre-defined values of the underlying xgboost learns good
and reasonably complex results. However, if one wishes to tune them the
recommended path would be to first start with changing the value of
<code>num_breaks</code> to e.g.: 20 or 30. If that doesn't give satisfactory results
one could experiment with modifying the <code>tree_depth</code> or <code>min_n</code> parameters.
Note that it is not recommended to tune <code>learn_rate</code> simultaneously with
other parameters.</p>
<p>This step requires the <span class="pkg">xgboost</span> package. If not installed, the
step will stop with a note about installing the package.</p>
<p>Note that the original data will be replaced with the new bins.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='step_discretize_cart.html'>step_discretize_cart()</a></code>, <code><a href='https://recipes.tidymodels.org/reference/recipe.html'>recipes::recipe()</a></code>,
<code><a href='https://recipes.tidymodels.org/reference/prep.html'>recipes::prep.recipe()</a></code>, <code><a href='https://recipes.tidymodels.org/reference/bake.html'>recipes::bake.recipe()</a></code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://modeldata.tidymodels.org'>modeldata</a></span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>credit_data</span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://rsample.tidymodels.org'>rsample</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/tidymodels/recipes'>recipes</a></span><span class='op'>)</span>

<span class='va'>split</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rsample.tidymodels.org/reference/initial_split.html'>initial_split</a></span><span class='op'>(</span><span class='va'>credit_data</span>, strata <span class='op'>=</span> <span class='st'>"Status"</span><span class='op'>)</span>

<span class='va'>credit_data_tr</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rsample.tidymodels.org/reference/initial_split.html'>training</a></span><span class='op'>(</span><span class='va'>split</span><span class='op'>)</span>
<span class='va'>credit_data_te</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rsample.tidymodels.org/reference/initial_split.html'>testing</a></span><span class='op'>(</span><span class='va'>split</span><span class='op'>)</span>

<span class='va'>xgb_rec</span> <span class='op'>&lt;-</span> 
  <span class='fu'><a href='https://recipes.tidymodels.org/reference/recipe.html'>recipe</a></span><span class='op'>(</span><span class='va'>Status</span> <span class='op'>~</span> <span class='va'>.</span>, data <span class='op'>=</span> <span class='va'>credit_data_tr</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://recipes.tidymodels.org/reference/step_impute_median.html'>step_medianimpute</a></span><span class='op'>(</span><span class='fu'><a href='https://recipes.tidymodels.org/reference/has_role.html'>all_numeric</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>step_discretize_xgb</span><span class='op'>(</span><span class='fu'><a href='https://recipes.tidymodels.org/reference/has_role.html'>all_numeric</a></span><span class='op'>(</span><span class='op'>)</span>, outcome <span class='op'>=</span> <span class='st'>"Status"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='warning'>Warning: `step_medianimpute()` was deprecated in recipes 0.1.16.</span>
#&gt; <span class='warning'>Please use `step_impute_median()` instead.</span></div><div class='input'>
<span class='kw'>if</span> <span class='op'>(</span><span class='fu'>rlang</span><span class='fu'>::</span><span class='fu'><a href='https://rlang.r-lib.org/reference/is_installed.html'>is_installed</a></span><span class='op'>(</span><span class='st'>"xgboost"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>xgb_rec</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://recipes.tidymodels.org/reference/prep.html'>prep</a></span><span class='op'>(</span><span class='va'>xgb_rec</span>, training <span class='op'>=</span> <span class='va'>credit_data_tr</span><span class='op'>)</span>

   <span class='fu'><a href='https://recipes.tidymodels.org/reference/bake.html'>bake</a></span><span class='op'>(</span><span class='va'>xgb_rec</span>, <span class='va'>credit_data_te</span>, <span class='va'>Price</span><span class='op'>)</span>
<span class='op'>}</span>
</div><div class='output co'>#&gt; <span class='warning'>Warning: More than 20 unique training set values are required. Predictors 'Time' were not processed; their original values will be used.</span></div><div class='output co'>#&gt; [21:13:21] WARNING: amalgamation/../src/learner.cc:1061: Starting in XGBoost 1.3.0, the default evaluation metric used with the objective 'binary:logistic' was changed from 'error' to 'logloss'. Explicitly set eval_metric if you'd like to restore the old behavior.
#&gt; [21:13:21] WARNING: amalgamation/../src/learner.cc:1061: Starting in XGBoost 1.3.0, the default evaluation metric used with the objective 'binary:logistic' was changed from 'error' to 'logloss'. Explicitly set eval_metric if you'd like to restore the old behavior.
#&gt; [21:13:21] WARNING: amalgamation/../src/learner.cc:1061: Starting in XGBoost 1.3.0, the default evaluation metric used with the objective 'binary:logistic' was changed from 'error' to 'logloss'. Explicitly set eval_metric if you'd like to restore the old behavior.
#&gt; [21:13:21] WARNING: amalgamation/../src/learner.cc:1061: Starting in XGBoost 1.3.0, the default evaluation metric used with the objective 'binary:logistic' was changed from 'error' to 'logloss'. Explicitly set eval_metric if you'd like to restore the old behavior.
#&gt; [21:13:21] WARNING: amalgamation/../src/learner.cc:1061: Starting in XGBoost 1.3.0, the default evaluation metric used with the objective 'binary:logistic' was changed from 'error' to 'logloss'. Explicitly set eval_metric if you'd like to restore the old behavior.
#&gt; [21:13:21] WARNING: amalgamation/../src/learner.cc:1061: Starting in XGBoost 1.3.0, the default evaluation metric used with the objective 'binary:logistic' was changed from 'error' to 'logloss'. Explicitly set eval_metric if you'd like to restore the old behavior.
#&gt; [21:13:21] WARNING: amalgamation/../src/learner.cc:1061: Starting in XGBoost 1.3.0, the default evaluation metric used with the objective 'binary:logistic' was changed from 'error' to 'logloss'. Explicitly set eval_metric if you'd like to restore the old behavior.
#&gt; [21:13:21] WARNING: amalgamation/../src/learner.cc:1061: Starting in XGBoost 1.3.0, the default evaluation metric used with the objective 'binary:logistic' was changed from 'error' to 'logloss'. Explicitly set eval_metric if you'd like to restore the old behavior.</div><div class='output co'>#&gt; <span style='color: #949494;'># A tibble: 1,113 x 1</span><span>
#&gt;    Price      
#&gt;    </span><span style='color: #949494;font-style: italic;'>&lt;fct&gt;</span><span>      
#&gt; </span><span style='color: #BCBCBC;'> 1</span><span> [2180, Inf]
#&gt; </span><span style='color: #BCBCBC;'> 2</span><span> [1300,1419)
#&gt; </span><span style='color: #BCBCBC;'> 3</span><span> [850,1055) 
#&gt; </span><span style='color: #BCBCBC;'> 4</span><span> [1636,2180)
#&gt; </span><span style='color: #BCBCBC;'> 5</span><span> [1419,1636)
#&gt; </span><span style='color: #BCBCBC;'> 6</span><span> [1300,1419)
#&gt; </span><span style='color: #BCBCBC;'> 7</span><span> [1055,1300)
#&gt; </span><span style='color: #BCBCBC;'> 8</span><span> [1300,1419)
#&gt; </span><span style='color: #BCBCBC;'> 9</span><span> [1419,1636)
#&gt; </span><span style='color: #BCBCBC;'>10</span><span> [-Inf,850) 
#&gt; </span><span style='color: #949494;'># … with 1,103 more rows</span><span></div></span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="tidyverse">
  <p>embed is a part of the <strong>tidymodels</strong> ecosystem, a collection of modeling packages designed with common APIs and a shared philosophy.</p>
</div>

<div class="author">
  <p>
    Developed by Max Kuhn.
    Site built by <a href="https://pkgdown.r-lib.org">pkgdown</a>.
  </p>
</div>

      </footer>
   </div>

  


  </body>
</html>


